# DecentriLicense Java SDK

Java bindings for the DecentriLicense C++ SDK via JNI.

## 环境要求

- **Java 17 或更高版本**（必须是ARM64原生版本，macOS上不能使用Rosetta的x86_64版本）
- Maven 3.x
- macOS: 需要通过Homebrew安装ARM64版本的OpenJDK

## 安装

### macOS (Apple Silicon)

```bash
# 1. 安装ARM64版本的Java
brew install openjdk@17

# 2. 设置环境变量（添加到 ~/.zshrc）
export JAVA_HOME=/opt/homebrew/opt/openjdk@17
export PATH="$JAVA_HOME/bin:$PATH"

# 3. 重新加载配置
source ~/.zshrc

# 4. 验证安装
java -version
file $(which java)  # 应该显示 "Mach-O 64-bit executable arm64"
```

### 编译项目

```bash
# 从 sdks/java 目录
cd sdks/java

# 编译项目
mvn clean package

# 或使用包装脚本（自动设置Java环境）
./mvn.sh clean package
```

## 运行验证向导 | Run Validation Wizard

验证向导提供交互式界面来测试SDK的所有功能。
The validation wizard provides an interactive interface to test all SDK features.

```bash
# 方式1：使用Shell脚本（推荐）| Method 1: Using shell script (recommended)
./run_validation_wizard.sh

# 方式2：使用Maven | Method 2: Using Maven
mvn exec:java

# 方式3：使用包装脚本 | Method 3: Using wrapper script
./mvn.sh exec:java
```

## ⚠️ 重要安全提示 | Important Security Notice

**测试公钥警告 | Test Public Key Warning:**

`sdks/` 目录下的所有公钥文件（如 `public_test_*.pem`）仅供开发和测试使用，**请勿在生产环境中使用**。
All public key files in the `sdks/` directory (such as `public_test_*.pem`) are for development and testing purposes only. **DO NOT use them in production environments.**

生产环境必须使用 `dl-issuer` 工具生成的专用密钥对。
Production environments must use dedicated key pairs generated by the `dl-issuer` tool.

## Usage

```java
import com.decentrilicense.DecentriLicenseClient;
import com.decentrilicense.LicenseException;

public class Example {
    public static void main(String[] args) {
        DecentriLicenseClient client = null;
        try {
            // Create a new client
            client = new DecentriLicenseClient();
            
            // Initialize the client
            client.initialize("YOUR-LICENSE-CODE", 8888, 8889);
            
            // Activate the license
            boolean success = client.activate();
            if (success) {
                System.out.println("License activated successfully");
                
                // Get current token
                Token token = client.getCurrentToken();
                if (token != null) {
                    System.out.println("Token ID: " + token.getTokenId());
                }
            }
        } catch (LicenseException e) {
            System.err.println("License error: " + e.getMessage());
        } finally {
            if (client != null) {
                try {
                    client.close();
                } catch (Exception e) {
                    System.err.println("Error closing client: " + e.getMessage());
                }
            }
        }
    }
}
```

## Package Installation

To use the pre-built package:

### Maven Integration
Add the following dependency to your pom.xml:
```xml
<dependency>
    <groupId>com.decentrilicense</groupId>
    <artifactId>decentrilicense-java</artifactId>
    <version>1.0.0</version>
</dependency>
```

### Manual Installation
1. Download the JAR file and add it to your project's classpath.

2. From source code:
   ```bash
   tar -xzf decentrilicense-java-src-1.0.0.tar.gz
   cd decentrilicense-java-src-1.0.0
   mvn clean package
   ```

## API Reference

### DecentriLicenseClient
- `DecentriLicenseClient()` - Create a new DecentriLicense client
- `initialize(String licenseCode, int udpPort, int tcpPort)` - Initialize the client with configuration
- `activate()` - Activate the license
- `getCurrentToken()` - Get the current token if activated
- `isActivated()` - Check if the license is activated
- `getDeviceId()` - Get the device ID
- `getDeviceState()` - Get the current device state
- `shutdown()` - Shutdown the client
- `close()` - Close the client and free resources (implements AutoCloseable)

### LicenseException
Custom exception class for license-related errors.

## Example

See the examples directory for complete examples of how to use the SDK.