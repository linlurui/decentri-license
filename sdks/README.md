# DecentriLicense SDK ä½¿ç”¨æŒ‡å— | SDK Usage Guide

æœ¬æ–‡æ¡£æä¾›æ‰€æœ‰è¯­è¨€SDKçš„è¯¦ç»†ä½¿ç”¨è¯´æ˜å’Œæ“ä½œæŒ‡å¼•ã€‚
This document provides detailed usage instructions and operational guidelines for all language SDKs.

## âš ï¸ é‡è¦å®‰å…¨æç¤º | Important Security Notice

**æµ‹è¯•å…¬é’¥è­¦å‘Š | Test Public Key Warning:**

`sdks/` ç›®å½•ä¸‹çš„æ‰€æœ‰å…¬é’¥æ–‡ä»¶ï¼ˆå¦‚ `public_test_*.pem`ï¼‰ä»…ä¾›å¼€å‘å’Œæµ‹è¯•ä½¿ç”¨ï¼Œ**è¯·å‹¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨**ã€‚
All public key files in the `sdks/` directory (such as `public_test_*.pem`) are for development and testing purposes only. **DO NOT use them in production environments.**

ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ `dl-issuer` å·¥å…·ç”Ÿæˆçš„ä¸“ç”¨å¯†é’¥å¯¹ã€‚
Production environments must use dedicated key pairs generated by the `dl-issuer` tool.

---

## ğŸ“‹ ç›®å½• | Table of Contents

- [æ”¯æŒçš„è¯­è¨€](#æ”¯æŒçš„è¯­è¨€)
- [é€šç”¨æ¦‚å¿µ](#é€šç”¨æ¦‚å¿µ)
- [å„è¯­è¨€SDKä½¿ç”¨è¯´æ˜](#å„è¯­è¨€sdkä½¿ç”¨è¯´æ˜)
  - [Java SDK](#java-sdk)
  - [Python SDK](#python-sdk)
  - [Node.js SDK](#nodejs-sdk)
  - [C# SDK](#c-sdk)
  - [Rust SDK](#rust-sdk)
  - [C++ SDK](#c-sdk-1)
  - [Go SDK](#go-sdk)
  - [C SDK](#c-sdk-2)
  - [PHP SDK](#php-sdk)
- [éªŒè¯å‘å¯¼åŠŸèƒ½](#éªŒè¯å‘å¯¼åŠŸèƒ½)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ”¯æŒçš„è¯­è¨€

DecentriLicense æä¾›ä»¥ä¸‹è¯­è¨€çš„SDKï¼š

| è¯­è¨€ | çŠ¶æ€ | éªŒè¯å‘å¯¼ | è¯´æ˜ |
|------|------|----------|------|
| Java | âœ… å®Œæ•´æ”¯æŒ | âœ… | JNIç»‘å®šï¼Œæ”¯æŒJava 17+ |
| Python | âœ… å®Œæ•´æ”¯æŒ | âœ… | ctypesç»‘å®šï¼Œæ”¯æŒPython 3.8+ |
| Node.js | âœ… å®Œæ•´æ”¯æŒ | âœ… | N-APIåŸç”Ÿæ¨¡å— |
| C# | âœ… å®Œæ•´æ”¯æŒ | âœ… | P/Invokeç»‘å®šï¼Œæ”¯æŒ.NET 6+ |
| Rust | âœ… å®Œæ•´æ”¯æŒ | âœ… | FFIç»‘å®š |
| C++ | âœ… å®Œæ•´æ”¯æŒ | âœ… | åŸç”ŸC++æ¥å£ |
| Go | âœ… å®Œæ•´æ”¯æŒ | âœ… | CGOç»‘å®š |
| C | âœ… å®Œæ•´æ”¯æŒ | âœ… | åŸç”ŸCæ¥å£ |
| PHP | âœ… å®Œæ•´æ”¯æŒ | âŒ | FFIç»‘å®š |

---

## é€šç”¨æ¦‚å¿µ

### Tokenç±»å‹

DecentriLicenseæ”¯æŒä¸‰ç§ç±»å‹çš„Tokenï¼š

1. **åŠ å¯†Tokenï¼ˆEncrypted Tokenï¼‰**
   - åˆå§‹ç­¾å‘çš„Tokenï¼Œéœ€è¦é¦–æ¬¡æ¿€æ´»
   - æ–‡ä»¶åé€šå¸¸ä¸åŒ…å«"activated"æˆ–"state"
   - éœ€è¦è°ƒç”¨æ¿€æ´»APIæ‰èƒ½ä½¿ç”¨

2. **å·²æ¿€æ´»Tokenï¼ˆActivated Tokenï¼‰**
   - å·²ç»å®Œæˆè®¾å¤‡ç»‘å®šçš„Token
   - æ–‡ä»¶ååŒ…å«"activated"
   - å¯ä»¥ç›´æ¥å¯¼å…¥ä½¿ç”¨ï¼Œä½†éœ€è¦è°ƒç”¨`ActivateBindDevice()`æ¢å¤æ¿€æ´»çŠ¶æ€

3. **çŠ¶æ€Tokenï¼ˆState Tokenï¼‰**
   - åŒ…å«ä½¿ç”¨è®°å½•çš„Token
   - æ–‡ä»¶ååŒ…å«"state"å’ŒçŠ¶æ€ç´¢å¼•ï¼ˆå¦‚"idx1"ï¼‰
   - å¯¼å…¥åéœ€è¦è°ƒç”¨`ActivateBindDevice()`æ¢å¤æ¿€æ´»çŠ¶æ€

### æ ¸å¿ƒAPI

æ‰€æœ‰SDKéƒ½æä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- **åˆå§‹åŒ–å®¢æˆ·ç«¯**ï¼šé…ç½®è®¸å¯è¯ä»£ç ã€ç«¯å£ç­‰
- **è®¾ç½®äº§å“å…¬é’¥**ï¼šç”¨äºéªŒè¯Tokenç­¾å
- **å¯¼å…¥Token**ï¼šä»æ–‡ä»¶æˆ–å­—ç¬¦ä¸²å¯¼å…¥Token
- **æ¿€æ´»è®¾å¤‡ç»‘å®š**ï¼šå°†Tokenç»‘å®šåˆ°å½“å‰è®¾å¤‡
- **éªŒè¯Token**ï¼šç¦»çº¿éªŒè¯Tokenæœ‰æ•ˆæ€§
- **è®°è´¦ï¼ˆRecord Usageï¼‰**ï¼šè®°å½•ä½¿ç”¨ä¿¡æ¯åˆ°çŠ¶æ€é“¾
- **å¯¼å‡ºToken**ï¼šå¯¼å‡ºåŠ å¯†æˆ–çŠ¶æ€å˜æ›´åçš„Token
- **è·å–çŠ¶æ€**ï¼šæŸ¥è¯¢å½“å‰TokençŠ¶æ€ä¿¡æ¯

### çŠ¶æ€é“¾ï¼ˆUsage Chainï¼‰

çŠ¶æ€é“¾æ˜¯DecentriLicenseçš„æ ¸å¿ƒåˆ›æ–°ï¼Œæ¯æ¬¡è®°è´¦æ“ä½œéƒ½ä¼šåœ¨é“¾ä¸Šè¿½åŠ ä¸€æ¡è®°å½•ï¼š

```json
{
  "seq": 1,
  "time": 1234567890,
  "action": "api_call",
  "params": {"function": "process_image"},
  "hash_prev": "previous_hash",
  "signature": "signature_of_this_entry"
}
```

---

## å„è¯­è¨€SDKä½¿ç”¨è¯´æ˜

### Java SDK

#### ç¯å¢ƒè¦æ±‚

- Java 17 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆARM64åŸç”Ÿç‰ˆæœ¬ï¼ŒmacOSä¸Šæ¨èä½¿ç”¨Homebrewå®‰è£…ï¼‰
- Maven 3.x
- macOS: éœ€è¦ARM64ç‰ˆæœ¬çš„Javaï¼ˆä¸èƒ½ä½¿ç”¨Rosettaçš„x86_64ç‰ˆæœ¬ï¼‰

#### å®‰è£…

**macOS (Apple Silicon):**
```bash
# å®‰è£…ARM64ç‰ˆæœ¬çš„Java
brew install openjdk@17

# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ·»åŠ åˆ° ~/.zshrcï¼‰
export JAVA_HOME=/opt/homebrew/opt/openjdk@17
export PATH="$JAVA_HOME/bin:$PATH"

# é‡æ–°åŠ è½½é…ç½®
source ~/.zshrc
```

**éªŒè¯å®‰è£…:**
```bash
java -version
file $(which java)  # åº”è¯¥æ˜¾ç¤º "Mach-O 64-bit executable arm64"
```

#### ç¼–è¯‘

```bash
cd sdks/java

# ç¼–è¯‘é¡¹ç›®
mvn clean package

# æˆ–ä½¿ç”¨åŒ…è£…è„šæœ¬ï¼ˆè‡ªåŠ¨è®¾ç½®Javaç¯å¢ƒï¼‰
./mvn.sh clean package
```

#### è¿è¡ŒéªŒè¯å‘å¯¼

```bash
# æ–¹å¼1ï¼šä½¿ç”¨Shellè„šæœ¬ï¼ˆæ¨èï¼‰
./run_validation_wizard.sh

# æ–¹å¼2ï¼šä½¿ç”¨Maven
mvn exec:java

# æ–¹å¼3ï¼šä½¿ç”¨åŒ…è£…è„šæœ¬
./mvn.sh exec:java
```

#### ä»£ç ç¤ºä¾‹

```java
import com.decentrilicense.*;

public class Example {
    public static void main(String[] args) {
        // åˆ›å»ºå®¢æˆ·ç«¯
        DecentriLicenseClient client = new DecentriLicenseClient();

        try {
            // åˆå§‹åŒ–
            client.initialize("YOUR-LICENSE-CODE", 13325, 23325, null);

            // è®¾ç½®äº§å“å…¬é’¥
            String publicKey = readFile("public_key.pem");
            client.setProductPublicKey(publicKey);

            // å¯¼å…¥Token
            String token = readFile("token.txt");
            client.importToken(token);

            // æ¿€æ´»è®¾å¤‡ç»‘å®š
            VerificationResult result = client.activateBindDevice();
            if (result.isValid()) {
                System.out.println("æ¿€æ´»æˆåŠŸï¼");
            }

            // è®°è´¦
            String payload = "{\"action\":\"api_call\",\"params\":{\"function\":\"test\"}}";
            VerificationResult recordResult = client.recordUsage(payload);
            if (recordResult.isValid()) {
                System.out.println("è®°è´¦æˆåŠŸï¼");

                // å¯¼å‡ºçŠ¶æ€å˜æ›´åçš„Token
                String newToken = client.exportStateChangedTokenEncrypted();
                writeFile("token_state.txt", newToken);
            }

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            client.shutdown();
            client.destroy();
        }
    }
}
```

#### å¸¸è§é—®é¢˜

**é—®é¢˜1: UnsatisfiedLinkError: no decenlicense_jni in java.library.path**

è§£å†³æ–¹æ¡ˆï¼š
- ç¡®ä¿ä½¿ç”¨ARM64ç‰ˆæœ¬çš„Javaï¼ˆä¸æ˜¯x86_64ï¼‰
- ç¡®ä¿`.mvn/jvm.config`æ–‡ä»¶å­˜åœ¨
- ä½¿ç”¨`./run_validation_wizard.sh`è„šæœ¬è¿è¡Œ

**é—®é¢˜2: æ¶æ„ä¸åŒ¹é…é”™è¯¯ (have 'arm64', need 'x86_64')**

è§£å†³æ–¹æ¡ˆï¼š
```bash
# å¸è½½x86_64ç‰ˆæœ¬çš„Java
brew uninstall openjdk

# å®‰è£…ARM64ç‰ˆæœ¬
brew install openjdk@17

# è®¾ç½®JAVA_HOME
export JAVA_HOME=/opt/homebrew/opt/openjdk@17
```

---

### Python SDK

#### ç¯å¢ƒè¦æ±‚

- Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- pip

#### å®‰è£…

```bash
cd sdks/python

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœæœ‰ï¼‰
pip install -r requirements.txt
```

#### è¿è¡ŒéªŒè¯å‘å¯¼

```bash
cd sdks/python
python validation_wizard.py
```

#### ä»£ç ç¤ºä¾‹

```python
from decenlicense import DecentriLicenseClient

# åˆ›å»ºå®¢æˆ·ç«¯
client = DecentriLicenseClient()

try:
    # åˆå§‹åŒ–
    client.initialize("YOUR-LICENSE-CODE", 13325, 23325, None)

    # è®¾ç½®äº§å“å…¬é’¥
    with open("public_key.pem", "r") as f:
        public_key = f.read()
    client.set_product_public_key(public_key)

    # å¯¼å…¥Token
    with open("token.txt", "r") as f:
        token = f.read()
    client.import_token(token)

    # æ¿€æ´»è®¾å¤‡ç»‘å®š
    result = client.activate_bind_device()
    if result['valid']:
        print("æ¿€æ´»æˆåŠŸï¼")

    # è®°è´¦
    payload = '{"action":"api_call","params":{"function":"test"}}'
    record_result = client.record_usage(payload)
    if record_result['valid']:
        print("è®°è´¦æˆåŠŸï¼")

        # å¯¼å‡ºçŠ¶æ€å˜æ›´åçš„Token
        new_token = client.export_state_changed_token_encrypted()
        with open("token_state.txt", "w") as f:
            f.write(new_token)

finally:
    client.shutdown()
    client.destroy()
```

---

### Node.js SDK

#### ç¯å¢ƒè¦æ±‚

- Node.js 14 æˆ–æ›´é«˜ç‰ˆæœ¬
- npm æˆ– yarn

#### å®‰è£…

```bash
cd sdks/nodejs

# å®‰è£…ä¾èµ–
npm install

# ç¼–è¯‘åŸç”Ÿæ¨¡å—
npm run build
```

#### è¿è¡ŒéªŒè¯å‘å¯¼

```bash
cd sdks/nodejs
node validation_wizard.js
```

#### ä»£ç ç¤ºä¾‹

```javascript
const { DecentriLicenseClient } = require('./build/Release/decenlicense_node');
const fs = require('fs');

// åˆ›å»ºå®¢æˆ·ç«¯
const client = new DecentriLicenseClient();

try {
    // åˆå§‹åŒ–
    client.initialize("YOUR-LICENSE-CODE", 13325, 23325, null);

    // è®¾ç½®äº§å“å…¬é’¥
    const publicKey = fs.readFileSync("public_key.pem", "utf8");
    client.setProductPublicKey(publicKey);

    // å¯¼å…¥Token
    const token = fs.readFileSync("token.txt", "utf8");
    client.importToken(token);

    // æ¿€æ´»è®¾å¤‡ç»‘å®š
    const result = client.activateBindDevice();
    if (result.valid) {
        console.log("æ¿€æ´»æˆåŠŸï¼");
    }

    // è®°è´¦
    const payload = JSON.stringify({
        action: "api_call",
        params: { function: "test" }
    });
    const recordResult = client.recordUsage(payload);
    if (recordResult.valid) {
        console.log("è®°è´¦æˆåŠŸï¼");

        // å¯¼å‡ºçŠ¶æ€å˜æ›´åçš„Token
        const newToken = client.exportStateChangedTokenEncrypted();
        fs.writeFileSync("token_state.txt", newToken);
    }

} finally {
    client.shutdown();
    client.destroy();
}
```

---

### C# SDK

#### ç¯å¢ƒè¦æ±‚

- .NET 6.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- Visual Studio 2022 æˆ– dotnet CLI

#### ç¼–è¯‘

```bash
cd sdks/csharp

# ä½¿ç”¨dotnet CLIç¼–è¯‘
dotnet build

# æˆ–ä½¿ç”¨Visual Studioæ‰“å¼€DecentriLicense.sln
```

#### è¿è¡ŒéªŒè¯å‘å¯¼

```bash
cd sdks/csharp
dotnet run --project DecentriLicense
```

#### ä»£ç ç¤ºä¾‹

```csharp
using DecentriLicense;

// åˆ›å»ºå®¢æˆ·ç«¯
var client = new DecentriLicenseClient();

try
{
    // åˆå§‹åŒ–
    client.Initialize("YOUR-LICENSE-CODE", 13325, 23325, null);

    // è®¾ç½®äº§å“å…¬é’¥
    var publicKey = File.ReadAllText("public_key.pem");
    client.SetProductPublicKey(publicKey);

    // å¯¼å…¥Token
    var token = File.ReadAllText("token.txt");
    client.ImportToken(token);

    // æ¿€æ´»è®¾å¤‡ç»‘å®š
    var result = client.ActivateBindDevice();
    if (result.Valid)
    {
        Console.WriteLine("æ¿€æ´»æˆåŠŸï¼");
    }

    // è®°è´¦
    var payload = "{\"action\":\"api_call\",\"params\":{\"function\":\"test\"}}";
    var recordResult = client.RecordUsage(payload);
    if (recordResult.Valid)
    {
        Console.WriteLine("è®°è´¦æˆåŠŸï¼");

        // å¯¼å‡ºçŠ¶æ€å˜æ›´åçš„Token
        var newToken = client.ExportStateChangedTokenEncrypted();
        File.WriteAllText("token_state.txt", newToken);
    }
}
finally
{
    client.Shutdown();
    client.Destroy();
}
```

---

### Rust SDK

#### ç¯å¢ƒè¦æ±‚

- Rust 1.70 æˆ–æ›´é«˜ç‰ˆæœ¬
- Cargo

#### ç¼–è¯‘

```bash
cd sdks/rust

# ç¼–è¯‘é¡¹ç›®
cargo build --release

# è¿è¡Œç¤ºä¾‹
cargo run --example validation_wizard
```

#### è¿è¡ŒéªŒè¯å‘å¯¼

```bash
cd sdks/rust
cargo run --example validation_wizard
```

#### ä»£ç ç¤ºä¾‹

```rust
use decentrilicense::DecentriLicenseClient;
use std::fs;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    // åˆ›å»ºå®¢æˆ·ç«¯
    let mut client = DecentriLicenseClient::new()?;

    // åˆå§‹åŒ–
    client.initialize("YOUR-LICENSE-CODE", 13325, 23325, None)?;

    // è®¾ç½®äº§å“å…¬é’¥
    let public_key = fs::read_to_string("public_key.pem")?;
    client.set_product_public_key(&public_key)?;

    // å¯¼å…¥Token
    let token = fs::read_to_string("token.txt")?;
    client.import_token(&token)?;

    // æ¿€æ´»è®¾å¤‡ç»‘å®š
    let result = client.activate_bind_device()?;
    if result.valid {
        println!("æ¿€æ´»æˆåŠŸï¼");
    }

    // è®°è´¦
    let payload = r#"{"action":"api_call","params":{"function":"test"}}"#;
    let record_result = client.record_usage(payload)?;
    if record_result.valid {
        println!("è®°è´¦æˆåŠŸï¼");

        // å¯¼å‡ºçŠ¶æ€å˜æ›´åçš„Token
        let new_token = client.export_state_changed_token_encrypted()?;
        fs::write("token_state.txt", new_token)?;
    }

    // æ¸…ç†
    client.shutdown()?;

    Ok(())
}
```

---

### C++ SDK

#### ç¯å¢ƒè¦æ±‚

- CMake 3.15+
- C++17å…¼å®¹ç¼–è¯‘å™¨
- OpenSSL 1.1.0+
- ASIO

#### ç¼–è¯‘

```bash
cd sdks/cpp/example

# åˆ›å»ºæ„å»ºç›®å½•
mkdir -p build && cd build

# é…ç½®
cmake ..

# ç¼–è¯‘
make

# è¿è¡ŒéªŒè¯å‘å¯¼
./validation_wizard
```

#### ä»£ç ç¤ºä¾‹

```cpp
#include "decenlicense_c.h"
#include <iostream>
#include <fstream>
#include <sstream>

int main() {
    // åˆ›å»ºå®¢æˆ·ç«¯
    DL_Client* client = dl_client_create();

    // åˆå§‹åŒ–
    DL_ClientConfig config = {};
    config.license_code = "YOUR-LICENSE-CODE";
    config.udp_port = 13325;
    config.tcp_port = 23325;
    config.registry_server_url = nullptr;

    if (dl_client_initialize(client, &config) != DL_ERROR_SUCCESS) {
        std::cerr << "åˆå§‹åŒ–å¤±è´¥" << std::endl;
        return 1;
    }

    // è®¾ç½®äº§å“å…¬é’¥
    std::ifstream pk_file("public_key.pem");
    std::string public_key((std::istreambuf_iterator<char>(pk_file)),
                           std::istreambuf_iterator<char>());
    dl_client_set_product_public_key(client, public_key.c_str());

    // å¯¼å…¥Token
    std::ifstream token_file("token.txt");
    std::string token((std::istreambuf_iterator<char>(token_file)),
                      std::istreambuf_iterator<char>());
    dl_client_import_token(client, token.c_str());

    // æ¿€æ´»è®¾å¤‡ç»‘å®š
    DL_VerificationResult result;
    if (dl_client_activate_bind_device(client, &result) == DL_ERROR_SUCCESS && result.valid) {
        std::cout << "æ¿€æ´»æˆåŠŸï¼" << std::endl;
    }

    // è®°è´¦
    const char* payload = "{\"action\":\"api_call\",\"params\":{\"function\":\"test\"}}";
    DL_VerificationResult record_result;
    if (dl_client_record_usage(client, payload, &record_result) == DL_ERROR_SUCCESS &&
        record_result.valid) {
        std::cout << "è®°è´¦æˆåŠŸï¼" << std::endl;

        // å¯¼å‡ºçŠ¶æ€å˜æ›´åçš„Token
        char new_token[65536];
        dl_client_export_state_changed_token_encrypted(client, new_token, sizeof(new_token));
        std::ofstream out("token_state.txt");
        out << new_token;
    }

    // æ¸…ç†
    dl_client_shutdown(client);
    dl_client_destroy(client);

    return 0;
}
```

---

### Go SDK

#### ç¯å¢ƒè¦æ±‚

- Go 1.21 æˆ–æ›´é«˜ç‰ˆæœ¬
- CGOæ”¯æŒ

#### ç¼–è¯‘

```bash
cd sdks/go

# ç¼–è¯‘
./build.sh

# æˆ–ç›´æ¥è¿è¡Œ
go run validation_wizard/validation_wizard.go
```

#### è¿è¡ŒéªŒè¯å‘å¯¼

```bash
cd sdks/go/validation_wizard
go run validation_wizard.go
```

#### ä»£ç ç¤ºä¾‹

```go
package main

import (
    "fmt"
    "io/ioutil"
    "github.com/yourusername/decentrilicense/go"
)

func main() {
    // åˆ›å»ºå®¢æˆ·ç«¯
    client := decentrilicense.NewClient()
    defer client.Destroy()

    // åˆå§‹åŒ–
    err := client.Initialize("YOUR-LICENSE-CODE", 13325, 23325, "")
    if err != nil {
        panic(err)
    }
    defer client.Shutdown()

    // è®¾ç½®äº§å“å…¬é’¥
    publicKey, _ := ioutil.ReadFile("public_key.pem")
    client.SetProductPublicKey(string(publicKey))

    // å¯¼å…¥Token
    token, _ := ioutil.ReadFile("token.txt")
    client.ImportToken(string(token))

    // æ¿€æ´»è®¾å¤‡ç»‘å®š
    result, err := client.ActivateBindDevice()
    if err == nil && result.Valid {
        fmt.Println("æ¿€æ´»æˆåŠŸï¼")
    }

    // è®°è´¦
    payload := `{"action":"api_call","params":{"function":"test"}}`
    recordResult, err := client.RecordUsage(payload)
    if err == nil && recordResult.Valid {
        fmt.Println("è®°è´¦æˆåŠŸï¼")

        // å¯¼å‡ºçŠ¶æ€å˜æ›´åçš„Token
        newToken, _ := client.ExportStateChangedTokenEncrypted()
        ioutil.WriteFile("token_state.txt", []byte(newToken), 0644)
    }
}
```

---

### C SDK

#### ç¯å¢ƒè¦æ±‚

- GCC æˆ– Clang
- CMake 3.15+
- OpenSSL 1.1.0+

#### ç¼–è¯‘

```bash
cd sdks/c

# ç¼–è¯‘
mkdir -p build && cd build
cmake ..
make

# è¿è¡ŒéªŒè¯å‘å¯¼
./validation_wizard
```

#### ä»£ç ç¤ºä¾‹

```c
#include "decenlicense_c.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main() {
    // åˆ›å»ºå®¢æˆ·ç«¯
    DL_Client* client = dl_client_create();

    // åˆå§‹åŒ–
    DL_ClientConfig config = {0};
    config.license_code = "YOUR-LICENSE-CODE";
    config.udp_port = 13325;
    config.tcp_port = 23325;
    config.registry_server_url = NULL;

    if (dl_client_initialize(client, &config) != DL_ERROR_SUCCESS) {
        fprintf(stderr, "åˆå§‹åŒ–å¤±è´¥\n");
        return 1;
    }

    // è®¾ç½®äº§å“å…¬é’¥
    FILE* pk_file = fopen("public_key.pem", "r");
    fseek(pk_file, 0, SEEK_END);
    long pk_size = ftell(pk_file);
    fseek(pk_file, 0, SEEK_SET);
    char* public_key = malloc(pk_size + 1);
    fread(public_key, 1, pk_size, pk_file);
    public_key[pk_size] = '\0';
    fclose(pk_file);

    dl_client_set_product_public_key(client, public_key);
    free(public_key);

    // å¯¼å…¥Token
    FILE* token_file = fopen("token.txt", "r");
    fseek(token_file, 0, SEEK_END);
    long token_size = ftell(token_file);
    fseek(token_file, 0, SEEK_SET);
    char* token = malloc(token_size + 1);
    fread(token, 1, token_size, token_file);
    token[token_size] = '\0';
    fclose(token_file);

    dl_client_import_token(client, token);
    free(token);

    // æ¿€æ´»è®¾å¤‡ç»‘å®š
    DL_VerificationResult result;
    if (dl_client_activate_bind_device(client, &result) == DL_ERROR_SUCCESS && result.valid) {
        printf("æ¿€æ´»æˆåŠŸï¼\n");
    }

    // è®°è´¦
    const char* payload = "{\"action\":\"api_call\",\"params\":{\"function\":\"test\"}}";
    DL_VerificationResult record_result;
    if (dl_client_record_usage(client, payload, &record_result) == DL_ERROR_SUCCESS &&
        record_result.valid) {
        printf("è®°è´¦æˆåŠŸï¼\n");

        // å¯¼å‡ºçŠ¶æ€å˜æ›´åçš„Token
        char new_token[65536];
        dl_client_export_state_changed_token_encrypted(client, new_token, sizeof(new_token));
        FILE* out = fopen("token_state.txt", "w");
        fprintf(out, "%s", new_token);
        fclose(out);
    }

    // æ¸…ç†
    dl_client_shutdown(client);
    dl_client_destroy(client);

    return 0;
}
```

---

### PHP SDK

#### ç¯å¢ƒè¦æ±‚

- PHP 8.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- FFIæ‰©å±•

#### ä½¿ç”¨

```bash
cd sdks/php

# è¿è¡Œç¤ºä¾‹
php example.php
```

#### ä»£ç ç¤ºä¾‹

```php
<?php
require_once 'decentrilicense.php';

// åˆ›å»ºå®¢æˆ·ç«¯
$client = new DecentriLicenseClient();

try {
    // åˆå§‹åŒ–
    $client->initialize("YOUR-LICENSE-CODE", 13325, 23325, null);

    // è®¾ç½®äº§å“å…¬é’¥
    $publicKey = file_get_contents("public_key.pem");
    $client->setProductPublicKey($publicKey);

    // å¯¼å…¥Token
    $token = file_get_contents("token.txt");
    $client->importToken($token);

    // æ¿€æ´»è®¾å¤‡ç»‘å®š
    $result = $client->activateBindDevice();
    if ($result['valid']) {
        echo "æ¿€æ´»æˆåŠŸï¼\n";
    }

    // è®°è´¦
    $payload = json_encode([
        'action' => 'api_call',
        'params' => ['function' => 'test']
    ]);
    $recordResult = $client->recordUsage($payload);
    if ($recordResult['valid']) {
        echo "è®°è´¦æˆåŠŸï¼\n";

        // å¯¼å‡ºçŠ¶æ€å˜æ›´åçš„Token
        $newToken = $client->exportStateChangedTokenEncrypted();
        file_put_contents("token_state.txt", $newToken);
    }

} finally {
    $client->shutdown();
    $client->destroy();
}
?>
```

---

## éªŒè¯å‘å¯¼åŠŸèƒ½

æ‰€æœ‰SDKï¼ˆé™¤PHPå¤–ï¼‰éƒ½æä¾›äº†äº¤äº’å¼éªŒè¯å‘å¯¼ï¼Œç”¨äºæµ‹è¯•å’ŒéªŒè¯SDKåŠŸèƒ½ã€‚

### ä¸»è¦åŠŸèƒ½

1. **é€‰æ‹©äº§å“å…¬é’¥** - è®¾ç½®ç”¨äºéªŒè¯Tokençš„äº§å“å…¬é’¥
2. **æ¿€æ´»ä»¤ç‰Œ** - é¦–æ¬¡æ¿€æ´»åŠ å¯†Token
3. **æ ¡éªŒå·²æ¿€æ´»ä»¤ç‰Œ** - éªŒè¯å·²æ¿€æ´»Tokençš„æœ‰æ•ˆæ€§
4. **éªŒè¯ä»¤ç‰Œåˆæ³•æ€§** - ç¦»çº¿éªŒè¯Tokenç­¾åå’Œå®Œæ•´æ€§
5. **è®°è´¦ä¿¡æ¯** - è®°å½•ä½¿ç”¨ä¿¡æ¯åˆ°çŠ¶æ€é“¾
6. **ä¿¡ä»»é“¾éªŒè¯** - éªŒè¯å®Œæ•´çš„ä¿¡ä»»é“¾
7. **ç»¼åˆéªŒè¯** - æ‰§è¡Œæ‰€æœ‰éªŒè¯æ­¥éª¤

### è®°è´¦å‘å¯¼

è®°è´¦å‘å¯¼æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š

#### 1. å¿«é€Ÿæµ‹è¯•æ¨¡å¼
ä½¿ç”¨é¢„è®¾çš„æµ‹è¯•æ•°æ®å¿«é€Ÿæµ‹è¯•è®°è´¦åŠŸèƒ½ï¼š
```json
{
  "action": "api_call",
  "params": {
    "result": "success",
    "function": "test_function"
  }
}
```

#### 2. å‘å¯¼å¼è¾“å…¥æ¨¡å¼
é€æ­¥è¾“å…¥ä¸šåŠ¡æ•°æ®ï¼š
- **action**: æ“ä½œç±»å‹ï¼ˆå¦‚"api_call"ã€"feature_use"ç­‰ï¼‰
- **params**: ä¸šåŠ¡å‚æ•°ï¼ˆJSONæ ¼å¼ï¼‰

### ä½¿ç”¨å·²æ¿€æ´»Tokençš„é‡è¦è¯´æ˜

å½“ä½¿ç”¨å·²æ¿€æ´»çš„Tokenï¼ˆæ–‡ä»¶ååŒ…å«"activated"æˆ–"state"ï¼‰è¿›è¡Œè®°è´¦æ—¶ï¼ŒSDKä¼šï¼š

1. è‡ªåŠ¨æ£€æµ‹Tokenç±»å‹
2. è°ƒç”¨`ActivateBindDevice()`æ¢å¤æ¿€æ´»çŠ¶æ€
3. æ˜¾ç¤º"âœ… æ¿€æ´»çŠ¶æ€å·²æ¢å¤ï¼ˆtokenæœªæ”¹å˜ï¼‰"
4. ç„¶åæ‰§è¡Œè®°è´¦æ“ä½œ

è¿™ç¡®ä¿äº†å·²æ¿€æ´»Tokenå¯ä»¥ç›´æ¥ç”¨äºè®°è´¦ï¼Œæ— éœ€é‡æ–°æ¿€æ´»ã€‚

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•é€‰æ‹©åˆé€‚çš„ç®—æ³•ï¼Ÿ

| åœºæ™¯ | æ¨èç®—æ³• | ç†ç”± |
|------|----------|------|
| è¿½æ±‚æè‡´æ€§èƒ½ | Ed25519 | é€Ÿåº¦æœ€å¿«ï¼Œç­¾åçŸ­ |
| æœ€å¤§å…¼å®¹æ€§ | RSA | è¡Œä¸šæ ‡å‡†ï¼Œå¹¿æ³›æ”¯æŒ |
| ä¸­å›½åˆè§„éœ€æ±‚ | SM2 | ç¬¦åˆå›½å¯†æ ‡å‡† |

### Q2: Tokenå¯ä»¥åœ¨å¤šä¸ªè®¾å¤‡ä¸Šä½¿ç”¨å—ï¼Ÿ

ä¸å¯ä»¥ã€‚Tokenåœ¨æ¿€æ´»æ—¶ä¼šç»‘å®šåˆ°ç‰¹å®šè®¾å¤‡ã€‚å¦‚æœéœ€è¦åœ¨å¦ä¸€å°è®¾å¤‡ä¸Šä½¿ç”¨ï¼Œéœ€è¦ï¼š
1. åœ¨åŸè®¾å¤‡ä¸Šå¯¼å‡ºToken
2. åœ¨æ–°è®¾å¤‡ä¸Šå¯¼å…¥Token
3. è°ƒç”¨`ActivateBindDevice()`é‡æ–°ç»‘å®š

### Q3: çŠ¶æ€é“¾æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

çŠ¶æ€é“¾è®°å½•äº†Tokençš„æ‰€æœ‰ä½¿ç”¨å†å²ï¼Œå¯ç”¨äºï¼š
- ä½¿ç”¨é‡ç»Ÿè®¡
- å®¡è®¡è¿½è¸ª
- é˜²ç¯¡æ”¹éªŒè¯
- ç¦»çº¿æº¯æº

### Q4: å¦‚ä½•å¤„ç†"not activated"é”™è¯¯ï¼Ÿ

å¦‚æœä½¿ç”¨å·²æ¿€æ´»Tokenæ—¶é‡åˆ°æ­¤é”™è¯¯ï¼Œç¡®ä¿ï¼š
1. å¯¼å…¥Tokenåè°ƒç”¨äº†`ActivateBindDevice()`
2. Tokenæ–‡ä»¶ç¡®å®æ˜¯å·²æ¿€æ´»çš„ï¼ˆæ–‡ä»¶ååŒ…å«"activated"æˆ–"state"ï¼‰
3. ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„äº§å“å…¬é’¥

### Q5: éªŒè¯å‘å¯¼æ‰¾ä¸åˆ°Tokenæ–‡ä»¶æ€ä¹ˆåŠï¼Ÿ

éªŒè¯å‘å¯¼ä¼šåœ¨ä»¥ä¸‹ä½ç½®æŸ¥æ‰¾Tokenæ–‡ä»¶ï¼š
- å½“å‰ç›®å½•
- çˆ¶ç›®å½•
- å„SDKç›®å½•

ä½ å¯ä»¥ï¼š
- è¾“å…¥å®Œæ•´çš„æ–‡ä»¶è·¯å¾„
- å°†Tokenæ–‡ä»¶å¤åˆ¶åˆ°å½“å‰ç›®å½•
- ç›´æ¥ç²˜è´´Tokenå­—ç¬¦ä¸²

### Q6: å¦‚ä½•æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Ÿ

```bash
# æ›´æ–°æ ¸å¿ƒåº“
cd dl-core
git pull
mkdir -p build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make

# é‡æ–°ç¼–è¯‘å„è¯­è¨€SDK
cd ../../sdks/[language]
# æŒ‰ç…§å„è¯­è¨€çš„ç¼–è¯‘è¯´æ˜é‡æ–°ç¼–è¯‘
```

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹å„SDKç›®å½•ä¸‹çš„READMEæ–‡ä»¶
2. æŸ¥çœ‹é¡¹ç›®ä¸»README: `/README.md`
3. æäº¤Issue: https://github.com/linlurui/decentri-license/issues

---

## æ›´æ–°æ—¥å¿—

### 2026-01-21
- âœ… ä¿®å¤Java SDKè®°è´¦å‘å¯¼çš„"not activated"é—®é¢˜
- âœ… æ‰€æœ‰SDKç°åœ¨éƒ½æ­£ç¡®å®ç°`ActivateBindDevice()`è°ƒç”¨
- âœ… ç»Ÿä¸€äº†æ‰€æœ‰SDKçš„è®°è´¦å‘å¯¼è¡Œä¸º

### 2026-01-20
- âœ… å®Œå–„äº†æ‰€æœ‰SDKçš„éªŒè¯å‘å¯¼åŠŸèƒ½
- âœ… æ·»åŠ äº†è®°è´¦å‘å¯¼çš„ä¸¤ç§æ¨¡å¼ï¼ˆå¿«é€Ÿæµ‹è¯•å’Œå‘å¯¼å¼è¾“å…¥ï¼‰
- âœ… æ”¹è¿›äº†Tokenç±»å‹æ£€æµ‹é€»è¾‘

---

**æœ€åæ›´æ–°**: 2026-01-21
